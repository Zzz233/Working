from sqlalchemy.ext.declarative import declarative_base
from sqlalchemy import Column, Integer, String, Text, DateTime, Index, JSON
from sqlalchemy import String, create_engine
from sqlalchemy.orm import sessionmaker
from sqlalchemy.sql import func
import requests
import redis
import time
import random
from contextlib import contextmanager

# Base = declarative_base()
#
#
# class History(Base):
#     __tablename__ = "journal_history"
#
#     Id = Column(Integer, primary_key=True, autoincrement=True, comment="id")
#     year = Column(Integer, nullable=True, comment="")
#     IPinfo = Column(JSON, nullable=True, comment="")
#
#
# class Journal(Base):
#     __tablename__ = "journal"
#
#     id = Column(Integer, primary_key=True, autoincrement=True, comment="id")
#     Abbr_Pubmed = Column(String(70), nullable=True, comment="")
#     ISSN = Column(String(40), nullable=True, comment="")
#     Abbr = Column(String(200), nullable=True, comment="")
#     IPinfo = Column(JSON, nullable=True, comment="")
#     impact_factor = Column(String(20), nullable=True, comment="")
#     journal_name = Column(String(500), nullable=True, comment="")
#
#
# engine = create_engine(
#     "mysql+pymysql://root:app1234@192.168.124.2:3306/pubmed_article?charset=utf8"
# )
# DBSession = sessionmaker(bind=engine)
# session = DBSession()
#
pool = redis.ConnectionPool(host="localhost", port=6379, decode_responses=True, db=14)
r = redis.Redis(connection_pool=pool)

# task_list = session.query(Journal).filter(Journal.ISSN not in History.Id).all()
task_list = ['2053-1583',
             '0730-0301',
             '2160-6455',
             '2574-0962',
             '2161-1653',
             '1087-2914',
             '2377-9098',
             '0903-4641',
             '1076-6332',
             '1742-7061',
             '2053-2296',
             '0044-5991',
             '2075-8251',
             '0284-186X',
             '1330-0075',
             '0567-8315',
             '1280-8571',
             '1940-0640',
             '0196-8858',
             '1548-5595',
             '0965-9978',
             '0065-2881',
             '1943-8206',
             '1863-8171',
             '1615-4150',
             '2513-0390',
             '2375-6314',
             '0096-140X',
             '0378-3774',
             '1323-8930',
             '1088-5412',
             '1942-2962',
             '0002-8703',
             '1526-5161',
             '1062-3264',
             '1049-9091',
             '1552-4868',
             '0002-9459',
             '0749-3797',
             '1943-8141',
             '0003-1348',
             '1075-9964',
             '0910-6340',
             '0003-3022',
             '1367-9430',
             '1751-7311',
             '0294-1260',
             '0196-0644',
             '1424-0637',
             '0785-3890',
             '0003-4894',
             '1941-1405',
             '1817-1737',
             '0066-4146',
             '2472-3428',
             '1543-592X',
             '0066-4197',
             '1543-5008',
             '0959-4973',
             '0195-6663',
             '0169-1317',
             '1175-5652',
             '2162-2965',
             '1931-9401',
             '2076-3417',
             '1353-5773',
             '0325-0075',
             '0004-0614',
             '0302-8933',
             '0003-9985',
             '0778-7367',
             '0304-8608',
             '0004-2749',
             '0933-3657',
             '1818-0876',
             '0004-6256',
             '1352-2310',
             '0045-0421',
             '1448-7527',
             '2588-994X',
             '0158-9938',
             '0005-2086',
             '2056-4724',
             '1471-2407',
             '2661-801X',
             '2662-7671',
             '1471-227X',
             '1471-2156',
             '1755-8794',
             '2661-8850',
             '1472-6955',
             '1471-2415',
             '2052-1847',
             '1471-2482',
             '2059-7908',
             '2515-1991',
             '2051-4190',
             '0140-525X',
             '1540-2002',
             '1756-0381',
             '1330-0962',
             '0925-4439',
             '2096-5524',
             '2380-6761',
             '1759-7269',
             '2228-5652',
             '1431-6730',
             '1480-9222',
             '2451-9022',
             '2042-6410',
             '2079-7737',
             '2050-7771',
             '1354-750X',
             '0959-2989',
             '2227-9059',
             '0006-341X',
             '0301-4622',
             '0144-8463',
             '2079-6374',
             '0734-9750',
             '0006-3606',
             '2352-3727',
             '2473-9529',
             '1359-5237',
             '2051-6673',
             '1512-8601',
             '0007-0920',
             '0007-1161',
             '0006-8950',
             '2394-8108',
             '2158-0014',
             '1015-6305',
             '1413-8670',
             '1340-6868',
             '0003-0007',
             '0273-0979',
             '0364-5916',
             '0735-2689',
             '2573-1599',
             '0828-282X',
             '0008-4204',
             '2095-3941',
             '0929-1903',
             '1740-5025',
             '0304-3835',
             '2049-3002',
             '1868-6958',
             '0008-5472',
             '1758-3004',
             '0920-3206',
             '0008-7114',
             '0923-2958',
             '2058-7716',
             '2352-345X',
             '0272-4340',
             '0963-6897',
             '1047-3211',
             '0098-6445',
             '0897-4756',
             '1005-9040',
             '2367-0932',
             '2227-9040',
             '2192-6506',
             '0305-1862',
             '2227-9067',
             '1001-8417',
             '0899-0042',
             '2045-709X',
             '2574-8300',
             '2212-0963',
             '1078-0432',
             '1178-7015',
             '1173-2563',
             '0009-9104',
             '1558-7673',
             '2048-8505',
             '2376-9998',
             '1179-5549',
             '2287-2728',
             '0303-8467',
             '0009-9201',
             '0009-9236',
             '1328-4207',
             '2167-7026',
             '2045-3329',
             '0143-5221',
             '2281-5872',
             '2001-1326',
             '1752-8054',
             '1871-4080',
             '2215-0382',
             '0260-3594',
             '2399-3642',
             '2399-3669',
             '2194-6701',
             '2399-3650',
             '0361-0918',
             '0965-2299',
             '1541-4337',
             '0045-7930',
             '0010-4620',
             '0305-0548',
             '1574-0137',
             '0167-9473',
             '0010-5422',
             '0176-4276',
             '0010-8545',
             '1441-2772',
             '0743-4863',
             '0011-2275',
             '1523-3804',
             '2198-6061',
             '1389-4501',
             '1573-4056',
             '1523-3790',
             '1359-0294',
             '2451-9103',
             '2452-2236',
             '0952-7915',
             '1087-2418',
             '1385-2728',
             '1574-888X',
             '1674-5507',
             '1552-4949',
             '1758-0463',
             '1710-3568',
             '1534-5807',
             '0012-1630',
             '0168-8227',
             '8755-1039',
             '0163-2116',
             '0278-0240',
             '1078-0947',
             '1366-9516',
             '0090-9556',
             '0012-0472',
             '2058-5241',
             '1831-4732',
             '0261-4189',
             '1878-5077',
             '2059-7029',
             '0196-0202',
             '2333-5084',
             '0906-7590',
             '1461-023X',
             '2192-1709',
             '1432-9840',
             '0717-3458',
             '1742-6731',
             '0160-9327',
             '2093-596X',
             '0423-104X',
             '2405-8297',
             '0013-7952',
             '1099-4300',
             '2047-2382',
             '0269-7491',
             '0944-1344',
             '0950-2688',
             '0957-7734',
             '0394-9370',
             '1148-5493',
             '1439-6319',
             '0031-6970',
             '1381-4788',
             '1469-0667',
             '0949-2321',
             '0909-8836',
             '0967-0262',
             '0748-7983',
             '0924-9338',
             '2405-4569',
             '1434-193X',
             '1090-5138',
             '2056-3744',
             '0922-6435',
             '2162-3619',
             '1058-6458',
             '1472-8214',
             '1747-4124',
             '0266-4720',
             '1542-2321',
             '0172-9179',
             '1389-9600',
             '2305-6983',
             '1015-3837',
             '0388-788X',
             '0169-5983',
             '1021-7762',
             '1935-5130',
             '2214-2894',
             '2636-0772',
             '1071-1007',
             '0925-9856',
             '1662-5153',
             '2297-055X',
             '2296-701X',
             '2296-598X',
             '2296-665X',
             '2296-7745',
             '1664-2295',
             '2296-861X',
             '1664-0640',
             '2296-875X',
             '1445-4408',
             '1746-0794',
             '0210-5705',
             '0001-7701',
             '2352-4820',
             '1880-7046',
             '1976-9571',
             '0741-0395',
             '1474-760X',
             '1467-4866',
             '2471-1403',
             '2196-4092',
             '1553-040X',
             '2151-4585',
             '0894-1491',
             '2056-6646',
             '2169-575X',
             '2054-4251',
             '2192-5682',
             '1463-9262',
             '1976-2283',
             '0720-9355',
             '1460-4582',
             '2227-9032',
             '1355-6037',
             '0440-6605',
             '1386-6346',
             '0270-9139',
             '1019-3316',
             '1601-5223',
             '0018-1544',
             '1120-7000',
             '1050-9631',
             '1108-4189',
             '0948-6143',
             '2662-6810',
             '1063-0198',
             '0018-7143',
             '1065-9471',
             '1749-0774',
             '0018-7208',
             '0964-6906',
             '0167-9457',
             '1027-5606',
             '1536-1225',
             '1089-7798',
             '1556-603X',
             '1066-033X',
             '0741-3106',
             '2473-2397',
             '0018-9200',
             '1949-307X',
             '1531-1309',
             '0890-8044',
             '2377-3766',
             '0018-926X',
             '2332-7731',
             '1063-6536',
             '2168-2267',
             '2475-1502',
             '1551-3203',
             '0018-9456',
             '1041-4347',
             '1536-1233',
             '1536-125X',
             '2327-4697',
             '0093-3813',
             '1053-587X',
             '1751-8660',
             '1091-9856',
             '2050-4527',
             '1598-2629',
             '1748-5908',
             '0301-1208',
             '0019-5154',
             '0019-5413',
             '0019-5456',
             '0250-474X',
             '0973-1458',
             '1420-326X',
             '0891-5520',
             '2468-0427',
             '2193-8229',
             '1350-4495',
             '2052-1553',
             '1869-4101',
             '1018-2438',
             '1349-2365',
             '1687-5869',
             '0141-8130',
             '1940-5901',
             '1368-5031',
             '1598-6446',
             '1550-1477',
             '0306-7319',
             '0960-3123',
             '0376-9429',
             '1878-450X',
             '1178-7074',
             '0885-6230',
             '1555-3396',
             '1744-232X',
             '2090-0384',
             '2198-4034',
             '1751-5521',
             '1438-4221',
             '1543-1649',
             '0129-0657',
             '1461-1457',
             '0020-7454',
             '2040-7939',
             '2352-0132',
             '1748-3735',
             '1687-9384',
             '0882-2786',
             '0960-7439',
             '2211-3207',
             '1687-9422',
             '0020-7608',
             '2196-7822',
             '1552-6283',
             '1066-8969',
             '1027-3719',
             '1041-6102',
             '1434-2944',
             '1540-7063',
             '2193-9764',
             '2213-4220',
             '0964-3397',
             '1444-0903',
             '2214-7829',
             '1445-5226',
             '2008-3866',
             '1938-2014',
             '0021-8464',
             '1063-8652',
             '0925-8388',
             '0002-7820',
             '1067-5027',
             '0003-1488',
             '0931-2668',
             '0021-8901',
             '1598-5865',
             '0921-8971',
             '0883-5403',
             '1178-6965',
             '0168-7433',
             '0145-479X',
             '0218-3390',
             '1674-8301',
             '0168-1656',
             '1940-1493',
             '1837-9664',
             '1558-2027',
             '2193-3677',
             '0021-9525',
             '0021-9584',
             '0886-9383',
             '0021-9665',
             '0192-0790',
             '0736-0258',
             '1308-5727',
             '2042-6305',
             '0021-9975',
             '0192-8651',
             '2288-4300',
             '0143-974X',
             '1010-5182',
             '0022-0337',
             '2314-6745',
             '1040-7294',
             '2050-2974',
             '0013-4651',
             '0099-2399',
             '2213-2929',
             '1059-0501',
             '2210-6006',
             '0926-9959',
             '1745-8080',
             '2471-5638',
             '0734-9041',
             '0889-9746',
             '0149-6085',
             '1069-5869',
             '2309-608X',
             '0022-1260',
             '0375-6742',
             '2169-9380',
             '2213-7165',
             '0894-1130',
             '0022-1481',
             '2253-5969',
             '0022-152X',
             '2054-8397',
             '1434-5161',
             '2214-5818',
             '0022-1767',
             '2467-964X',
             '0970-4140',
             '1178-7031',
             '1866-6892',
             '1748-0221',
             '0925-9902',
             '2052-0492',
             '0896-4327',
             '1011-8934',
             '1073-1105',
             '1090-7807',
             '0025-3154',
             '0022-2461',
             '0022-2496',
             '1932-6181',
             '0148-5598',
             '1057-7157',
             '0022-2836',
             '0022-2852',
             '1178-2390',
             '1617-1381',
             '0300-9564',
             '0340-5354',
             '0022-3050',
             '0911-6044',
             '0360-4012',
             '0195-9298',
             '0002-0443',
             '0301-4800',
             '1078-1552',
             '0904-2512',
             '2214-031X',
             '1590-9921',
             '0825-8597',
             '2056-4538',
             '0334-018X',
             '1477-5131',
             '1085-9489',
             '2075-4426',
             '1547-7037',
             '0022-3697',
             '0742-3098',
             '1125-4653',
             '1346-7395',
             '2274-5807',
             '1535-3893',
             '1741-3842',
             '0449-3060',
             '1755-6678',
             '0890-765X',
             '1615-9306',
             '0022-4561',
             '1092-4388',
             '1742-5468',
             '1047-8477',
             '0022-4804',
             '0022-4901',
             '0883-5993',
             '0914-9198',
             '1687-9686',
             '0142-6338',
             '2166-2746',
             '1018-1172',
             '1558-7878',
             '0166-0934',
             '2055-6640',
             '2043-9083',
             '1936-878X',
             '2574-3805',
             '2168-6181',
             '2368-7959',
             '1086-8089',
             '2542-4351',
             '2008-3645',
             '2296-9381',
             '2468-0249',
             '0968-0160',
             '0023-074X',
             '2005-9159',
             '2352-4642',
             '2213-2600',
             '0935-8943',
             '0305-7518',
             '2075-1729',
             '2575-1077',
             '2504-3161',
             '2378-2242',
             '1439-8621',
             '1354-9839',
             '1942-0862',
             '0749-1581',
             '2312-7481',
             '1995-7262',
             '1660-3397',
             '0377-8398',
             '0094-1492',
             '1369-7021',
             '2468-6069',
             '1874-8961',
             '0025-6196',
             '1091-367X',
             '0093-6413',
             '0958-3947',
             '0967-0742',
             '0465-5893',
             '0269-283X',
             '2077-0375',
             '1072-3714',
             '1086-9379',
             '1751-7915',
             '2352-3522',
             '2045-8827',
             '0141-9331',
             '0026-3672',
             '2095-7467',
             '2524-3462',
             '1120-4826',
             '2380-2359',
             '0166-6851',
             '1097-2765',
             '1177-1062',
             '1536-1632',
             '2515-4184',
             '1661-8769',
             '2051-3933',
             '0267-8357',
             '0178-7888',
             '2397-7132',
             '2055-5008',
             '2374-4677',
             '2397-3722',
             '2373-8057',
             '2397-768X',
             '2397-4648',
             '2057-3995',
             '2334-265X',
             '2056-7189',
             '2186-3326',
             '2452-0748',
             '2311-6706',
             '2157-846X',
             '2520-1158',
             '2520-1131',
             '2058-7546',
             '1748-3387',
             '2056-676X',
             '1759-4790',
             '2398-9629',
             '1661-7800',
             '0028-2804',
             '1673-5374',
             '2352-2895',
             '0364-3190',
             '1364-6745',
             '2376-7839',
             '2332-7812',
             '0305-1846',
             '2329-423X',
             '0959-4965',
             '1029-8428',
             '1462-2203',
             '1092-6194',
             '2159-3337',
             '0969-7330',
             '2054-1058',
             '0163-5581',
             '2072-6643',
             '0029-7828',
             '0966-7903',
             '1178-6930',
             '2352-7714',
             '0740-9303',
             '0925-3467',
             '1673-1905',
             '1566-1199',
             '2325-9671',
             '0030-6665',
             '1935-2735',
             '0269-5022',
             '2193-8237',
             '0031-0220',
             '0031-1820',
             '2049-632X',
             '1433-7541',
             '0749-5161',
             '0891-3668',
             '0031-3998',
             '2376-5992',
             '2475-8817',
             '0267-6591',
             '2047-0525',
             '1574-1192',
             '1424-8247',
             '1734-1140',
             '2052-1707',
             '0950-0839',
             '2578-5478',
             '1474-905X',
             '2304-6732',
             '1463-9076',
             '1047-9651',
             '2475-9953',
             '0378-4371',
             '0031-9317',
             '1568-7767',
             '1435-8603',
             '2475-4455',
             '0735-9640',
             '0032-0943',
             '1230-0322',
             '0141-3910',
             '2055-5660',
             '0032-5449',
             '0304-4289',
             '1463-4236',
             '0002-9939',
             '0029-6651',
             '2150-8097',
             '0079-6123',
             '0033-0620',
             '0300-9440',
             '2196-1042',
             '0079-6816',
             '1526-9248',
             '2287-8882',
             '0929-8665',
             '0033-2674',
             '1075-2730',
             '1323-1316',
             '0033-3174',
             '0033-3549',
             '2095-4689',
             '2056-3485',
             '1470-1626',
             '2522-0144',
             '2639-5274',
             '2198-6576',
             '0300-0729',
             '0960-2585',
             '1043-0679',
             '0924-4247',
             '0925-4005',
             '2297-8739',
             '0747-4946',
             '0923-5965',
             '2366-9608',
             '0277-9536',
             '2629-3269',
             '2194-0401',
             '1369-8486',
             '2352-5509',
             '0039-7911',
             '2405-805X',
             '2046-4053',
             '2042-0986',
             '1756-2872',
             '1477-9560',
             '2379-1381',
             '2305-6304',
             '0041-1337',
             '2288-5919',
             '2212-0955',
             '0300-9858',
             '0882-8245',
             '0920-8569',
             '2212-0947',
             '1936-900X',
             '1748-0272',
             '2220-3206',
             '2640-5237',
             '0044-0086',
             '2373-2822',
             '2589-0042',
             '2379-5077',
             '2324-7703',]

for i in task_list:
    print(i)
    r.rpush("fenqubiao", i)
    # print(item)

